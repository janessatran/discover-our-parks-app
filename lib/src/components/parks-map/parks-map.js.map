{"version":3,"file":"parks-map.js","sourceRoot":"","sources":["../../../../src/components/parks-map/parks-map.ts"],"names":[],"mappings":"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","sourcesContent":["import { CSSResult, html, TemplateResult } from \"lit\";\nimport { customElement, state } from \"lit/decorators.js\";\nimport { MobxLitElement } from \"@adobe/lit-mobx\";\n\nimport \"../about-section/about-section\";\nimport \"../info-card/info-card\";\nimport \"../photo-carousel/photo-carousel\";\nimport \"../parks-map/parks-map\";\n\nimport { setUpMap, addPopupToMap, flyTo } from \"../../../map\";\n\nimport * as mapboxgl from \"mapbox-gl\";\n\nimport { styles } from \"./parks-map.css\";\nimport { styles as mainLayoutStyles } from \"../main-layout/main-layout.css\";\nimport { styles as aboutSectionStyles } from \"../about-section/about-section.css\";\nimport { RequestInfo } from \"undici-types\";\n\n@customElement(\"parks-map\")\nexport class ParksMap extends MobxLitElement {\n  static styles: CSSResult[] = [mainLayoutStyles, aboutSectionStyles, styles];\n\n  @state()\n  parks = [];\n\n  mapElement: HTMLElement | undefined;\n\n  mapObj: mapboxgl.Map | undefined;\n\n  ready = false;\n\n  parkCodeToDataMap = new Map();\n\n  @state()\n  parkDescription = \"\";\n\n  @state()\n  parkUrl = \"\";\n\n  @state()\n  imagesForCarousel: (TemplateResult<1> | undefined)[] | undefined;\n\n  connectedCallback() {\n    super.connectedCallback();\n\n    window.addEventListener(\n      \"changed-photo-event\",\n      this.handleChangePhotoEvent.bind(this)\n    );\n  }\n\n  disconnectedCallback() {\n    super.disconnectedCallback();\n    window.removeEventListener(\n      \"changed-photo-event\",\n      this.handleChangePhotoEvent.bind(this)\n    );\n  }\n\n  repeatUntilMapReady() {\n    if (!this.mapObj) {\n      console.log(\"repeating until map ready\");\n      const mapEl = document.body.querySelector(\"#map\") as HTMLElement;\n      if (mapEl) {\n        mapEl.style.display = \"block\";\n        mapEl.style.width = \"100%\";\n        mapEl.style.minHeight = \"500px\";\n        this.mapElement = mapEl;\n        this.getMap();\n        this.requestUpdate();\n      } else {\n        const mapWrapperEl = document.body.querySelector(\n          \".map-wrapper\"\n        ) as HTMLElement;\n        const createdMap = document.createElement(\"div\");\n        createdMap.id = \"map\";\n        createdMap.style.height = \"400px\";\n        createdMap.style.width = \"100%\";\n        mapWrapperEl.appendChild(createdMap);\n      }\n      setTimeout(() => {\n        this.repeatUntilMapReady();\n      }, 1000); // Adjust the delay as needed\n    }\n  }\n\n  repeatUntilImagesReady() {\n    if (!this.imagesForCarousel || !this.parks) {\n      console.log(\"repeating until images/data ready\");\n\n      this.getData();\n      this.requestUpdate();\n    }\n\n    // Set a timeout to call the function again after a delay\n    setTimeout(() => {\n      this.repeatUntilImagesReady();\n    }, 1000); // Adjust the delay as needed\n  }\n\n  getMap() {\n    const map = setUpMap();\n    if (map) {\n      this.mapObj = map;\n    }\n\n    return this.mapObj ? true : false;\n  }\n\n  handleChangePhotoEvent(e: Event) {\n    console.log(e);\n    const event = e as CustomEvent;\n    if (this.parkCodeToDataMap) {\n      const parkData = this.parkCodeToDataMap.get(event.detail.metadata);\n      if (parkData) {\n        this.parkDescription = parkData.description;\n        this.parkUrl = parkData.url;\n        flyTo(this.mapObj, parkData);\n        // addPopupToMap(this.mapObj, parkData);\n      }\n    }\n  }\n\n  firstUpdated() {\n    this.repeatUntilMapReady();\n    if (this.mapElement) this.repeatUntilImagesReady();\n  }\n\n  async getData() {\n    await this.fetchParks();\n    this.imagesForCarousel = this.getImages();\n  }\n\n  async fetchWithTimeout(resource: RequestInfo, options?: any) {\n    const timeout = options?.timeout ?? 8000;\n\n    const controller = new AbortController();\n    const id = setTimeout(() => controller.abort(), timeout);\n\n    const response = await fetch(resource, {\n      ...options,\n      signal: controller.signal,\n    });\n    clearTimeout(id);\n\n    return response;\n  }\n\n  async fetchParks() {\n    const map = this.mapObj;\n    let parksData;\n\n    const response = await this.fetchWithTimeout(\n      \"https://developer.nps.gov/api/v1/parks?limit=100000\",\n      {\n        method: \"GET\",\n        headers: {\n          \"X-Api-Key\": \"Y8Idz9Ba8lWUazAqUHNfxwE1RR97i3TSuoYiBsL7\",\n        },\n        timeout: 4000,\n      }\n    );\n\n    const jsonResponse = await response.json();\n    parksData = jsonResponse.data;\n    this.parks = parksData;\n\n    parksData.forEach((park: any) => {\n      this.parkCodeToDataMap.set(park.parkCode, park);\n    });\n\n    parksData.slice(0, 1).forEach((park: any) => {\n      // addPopupToMap(map, park);\n      flyTo(map, park);\n    });\n  }\n\n  getImages() {\n    const imageTemplate = this.parks.map((park: any) => {\n      const img = park.images[0];\n\n      if (img) {\n        return html` <img\n          src=\"${img.url}\"\n          id=${park.fullName}\n          park-code=${park.parkCode}\n        />`;\n      }\n    });\n\n    const filtered = imageTemplate.filter((item) => item);\n    return filtered;\n  }\n\n  public render(): TemplateResult {\n    const placeholderImageForMap = html`<img\n      class=\"placeholder-img\"\n      src=\"https://images.unsplash.com/photo-1478860409698-8707f313ee8b?q=80&w=2940&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D\"\n    />`;\n    const placeholderText =\n      \"Beyond the towering trees and vast horizons lies a path to self-discovery. Nature's canvas becomes a mirror reflecting your innermost thoughts and aspirations. Wander the trails, traverse the meadows, and allow the whispers of the wilderness to guide you on a journey of self-reflection. Or, at least that's what nature evokes for me! Begin your exploration of the various parks by clicking the arrow above.\";\n\n    return html`\n      <div class=\"main-container\">\n        <about-section\n          title=\"Explore the map\"\n          .contentTemplate=${this.mapElement\n            ? this.mapElement\n            : placeholderImageForMap}\n        ></about-section>\n        <info-card\n          .initialTextContent=${this.parkDescription\n            ? this.parkDescription\n            : placeholderText}\n          .buttonLabel=${\"Learn more\"}\n          .buttonRoute=${this.parkUrl}\n        >\n          <photo-carousel\n            slot=\"photo-carousel-container\"\n            .name=${\"Click the arrow to begin exploring!\"}\n          >\n            <img\n              src=\"https://images.unsplash.com/photo-1592415251033-6d09541f9a23?q=80&w=2787&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D\"\n            />\n            ${this.imagesForCarousel}\n          </photo-carousel>\n        </info-card>\n      </div>\n    `;\n  }\n}\n"]}